-- [[ CONFIG ]] --
local WHITELIST_URL = "https://raw.githubusercontent.com/jamalyoung373739-bit/whitelist.json/main/json"
local HUB_URL = "https://raw.githubusercontent.com/jamalyoung373739-bit/Pharmacii1f/main/Finale"

-- [[ 1. GET ROBLOX USERNAME ]] --
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Username = LocalPlayer.Name -- This gets the actual account name, not DisplayName
local HttpService = game:GetService("HttpService")

-- [[ 2. FORCE COPY & NOTIFY ]] --
-- Try to copy the Username immediately
pcall(function() 
    if setclipboard then setclipboard(Username) end
    if toclipboard then toclipboard(Username) end
end)

-- Force message to F9 Console
print("------------------------------------------")
print("PHARMACII HUB AUTHENTICATION")
print("AUTHENTICATING USER: " .. Username)
print("USERNAME HAS BEEN COPIED TO CLIPBOARD")
print("------------------------------------------")

-- Windows/Screen Pop-up
pcall(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "PHARMACII USERNAME",
        Text = "Copied: " .. Username,
        Duration = 10,
        Icon = "rbxassetid://6031154871" 
    })
end)

-- Executor Console (if available)
if rconsoleprint then
    rconsoleprint("\nPHARMACII USER: " .. Username .. "\n")
    rconsoleprint("Copy the name above and send it to amiri in ur ticket.\n")
end

-- [[ 3. AUTHENTICATION LOGIC ]] --
print("PHARMACII: Verifying Username against Whitelist...")

local function Authenticate()
    local success, response = pcall(function()
        -- Adding timestamp to bypass caching
        return game:HttpGet(WHITELIST_URL .. "?t=" .. os.time())
    end)

    if success then
        -- Decode the JSON list
        local decodeSuccess, whitelist = pcall(function() return HttpService:JSONDecode(response) end)
        
        if not decodeSuccess then
            warn("PHARMACII: Failed to decode whitelist JSON. Check your JSON format!")
            return
        end

        local isWhitelisted = false

        -- Check Username
        for _, name in pairs(whitelist) do
            -- Compare the names (Exact match)
            if name == Username then
                isWhitelisted = true
                break
            end
        end

        if isWhitelisted then
            print("PHARMACII: ACCESS GRANTED. Loading Hub...")
            
            -- Load the Script
            local hubSuccess, hubCode = pcall(function()
                return game:HttpGet(HUB_URL)
            end)
            
            if hubSuccess then
                loadstring(hubCode)()
            else
                warn("PHARMACII: Whitelisted, but failed to fetch Hub script.")
            end
        else
            warn("PHARMACII: ACCESS DENIED.")
            print("Your Username ("..Username..") is not in the whitelist.")
            
            -- Notify user they are denied
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "ACCESS DENIED",
                Text = "Username copied. Send to Amiri.",
                Duration = 5
            })
        end
    else
        warn("PHARMACII: Connection Error (Check Whitelist URL).")
    end
end

task.spawn(Authenticate)
