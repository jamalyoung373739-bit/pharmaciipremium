-- [[ PHARMACII ALL-IN-ONE (WHITELIST + HUB) ]] --

-- 1. CONFIGURATION
local WHITELIST_URL = "https://raw.githubusercontent.com/jamalyoung373739-bit/whitelist.json/main/json"

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Username = LocalPlayer.Name
local StarterGui = game:GetService("StarterGui")

print("PHARMACII: Initializing for " .. Username .. "...")

-- [[ 2. THE HUB CODE (Encapsulated) ]] --
local function RunPharmaciiHub()
    print("PHARMACII: Whitelist Verified. Loading Hub...")
    StarterGui:SetCore("SendNotification", {Title="PHARMACII", Text="Welcome! Loading Hub..."})

    -- PASTE YOUR FULL SCRIPT BELOW HERE --
    
    -- [[ CONNECTION MANAGER ]] --
    local Connections = {} 

    local function AddConnection(signal, callback)
        local con = signal:Connect(callback)
        table.insert(Connections, con)
        return con
    end

    -- [[ PRE-LOAD PROTECTION ]] --
    task.spawn(function()
        local function disableAC()
            local p = game:GetService("Players").LocalPlayer
            if not p then return end
            local char = p.Character or p.CharacterAdded:Wait()
            local hb = char:WaitForChild("Hitbox", 5)
            if hb then
                local ac = hb:WaitForChild("LocalAntiCheat", 5)
                if ac then ac.Disabled = true end
            end
        end
        disableAC()
        AddConnection(game:GetService("Players").LocalPlayer.CharacterAdded, disableAC)
    end)

    local uis = game:GetService("UserInputService")
    local ts = game:GetService("TweenService")
    local rs = game:GetService("RunService")
    local p = game.Players.LocalPlayer
    local http = game:GetService("HttpService")
    local tps = game:GetService("TeleportService")
    local cam = workspace.CurrentCamera
    local vim = game:GetService("VirtualInputManager")

    -- [[ LIGHTING DEFAULTS ]] --
    local OriginTime = game:GetService("Lighting").ClockTime
    local OriginBright = game:GetService("Lighting").Brightness

    -- [[ GLOBAL SETTINGS ]] --
    _G.HideKey = Enum.KeyCode.LeftControl
    _G.MagRange = 10
    _G.TuckSpeed = 100
    _G.WalkSpeed = 16
    _G.JumpPower = 50
    _G.InfiniteJump = false 
    _G.CustomTime = 12
    _G.CustomBright = 2
    _G.QBPrediction = 10 
    _G.HBESize = 5

    local MagnetEnabled = false
    local VisualsEnabled = false
    local AutoTuckEnabled = false
    local NoclipEnabled = false
    local AdvancedBlocking = false
    local WalkspeedEnabled = false
    local JumppowerEnabled = false
    local QBFollowEnabled = false 
    local TruckingEnabled = false
    local AntiKnockbackEnabled = false 
    local BigHeadEnabled = false
    local ShowAllHitboxes = false 
    local AutoTackleEnabled = false 
    local QBAimbotEnabled = false
    local HBEEnabled = false
    local isFollowing = false 
    local canDrag = true
    local activeTabBtn = nil

    -- [[ STATE VARIABLES ]] --
    local isTruckingHeld = false 

    -- [[ MAGNET LATCH VARIABLES ]] --
    local MagnetActiveTime = 0
    local MAGNET_LATCH_DURATION = 0.5 

    -- [[ FEATURE REGISTRY ]] --
    local FeatureRegistry = {} 

    -- [[ THEME COLOR ]] --
    local ACCENT_COLOR = Color3.fromRGB(180, 100, 255)

    -- [[ PARENTING CHECK ]] --
    local SafeParent = game:GetService("CoreGui")
    pcall(function()
        if not SafeParent:FindFirstChild("RobloxGui") then
            SafeParent = p:WaitForChild("PlayerGui")
        end
    end)

    if SafeParent:FindFirstChild("PharmaciiHub_Master") then
        SafeParent.PharmaciiHub_Master:Destroy()
    end

    local MainGui = Instance.new("ScreenGui", SafeParent)
    MainGui.Name = "PharmaciiHub_Master"
    MainGui.ResetOnSpawn = false 

    -- [[ VISUALS SETUP ]] --
    local SelectionBox = Instance.new("SelectionBox", SafeParent)
    SelectionBox.Name = "PharmaciiVisuals"
    SelectionBox.Color3 = ACCENT_COLOR
    SelectionBox.LineThickness = 0.05

    local VisualPart = Instance.new("Part", workspace)
    VisualPart.Name = "PharmaciiMagBox"
    VisualPart.Transparency = 1
    VisualPart.Anchored = true
    VisualPart.CanCollide = false
    VisualPart.CanQuery = false 
    VisualPart.CanTouch = false 
    VisualPart.Massless = true 

    -- [[ MAIN UI ]] --
    local Main = Instance.new("Frame", MainGui)
    Main.Size = UDim2.new(0, 800, 0, 480); Main.Position = UDim2.new(0.5, -400, 0.5, -240)
    Main.BackgroundColor3 = Color3.fromRGB(12, 12, 14); Main.BorderSizePixel = 0
    Main.Visible = true 
    Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 6)

    -- [[ CLEANUP FUNCTION ]] --
    local function FullDestruction()
        for _, v in pairs(Connections) do
            if v then v:Disconnect() end
        end
        Connections = {}

        if VisualPart then VisualPart:Destroy() end
        if SelectionBox then SelectionBox:Destroy() end

        if p.Character then
            local hum = p.Character:FindFirstChild("Humanoid")
            local hrp = p.Character:FindFirstChild("HumanoidRootPart")
            if hum then
                hum.WalkSpeed = 16
                hum.JumpPower = 50
            end
            if hrp then hrp.AssemblyLinearVelocity = Vector3.zero end
            for _, v in pairs(p.Character:GetDescendants()) do
                if v:IsA("BasePart") then v.CanCollide = true end
            end
            local hb = p.Character:FindFirstChild("Hitbox") or p.Character:FindFirstChild("Jersey")
            if hb then hb.Size = Vector3.new(2.31, 5.4, 2.3) end
        end

        for _, pl in pairs(game.Players:GetPlayers()) do
            if pl.Character then
                local h = pl.Character:FindFirstChild("Head")
                if h then h.Size = Vector3.new(2,1,1); h.Transparency = 0 end
                local j = pl.Character:FindFirstChild("Jersey") or pl.Character:FindFirstChild("Hitbox")
                if j then j.Size = Vector3.new(2.31, 5.4, 2.3); j.Transparency = 1 end
            end
        end

        game:GetService("Lighting").ClockTime = OriginTime
        game:GetService("Lighting").Brightness = OriginBright

        if MainGui then MainGui:Destroy() end
    end

    -- [[ MOBILE TOGGLE BUTTON ]] --
    local ToggleFrame = Instance.new("Frame", MainGui)
    ToggleFrame.Size = UDim2.new(0, 50, 0, 50)
    ToggleFrame.Position = UDim2.new(0.1, 0, 0.1, 0) 
    ToggleFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 22)
    ToggleFrame.BorderSizePixel = 0
    ToggleFrame.Visible = uis.TouchEnabled 
    Instance.new("UICorner", ToggleFrame).CornerRadius = UDim.new(0, 8)
    local ToggleStroke = Instance.new("UIStroke", ToggleFrame)
    ToggleStroke.Color = ACCENT_COLOR; ToggleStroke.Thickness = 2

    local ToggleBtn = Instance.new("TextButton", ToggleFrame)
    ToggleBtn.Size = UDim2.new(1, 0, 1, 0)
    ToggleBtn.BackgroundTransparency = 1
    ToggleBtn.Text = "P"
    ToggleBtn.TextColor3 = ACCENT_COLOR
    ToggleBtn.Font = "GothamBold"
    ToggleBtn.TextSize = 24

    AddConnection(ToggleBtn.MouseButton1Click, function()
        Main.Visible = not Main.Visible
    end)

    local toggleDragging, toggleDragStart, toggleStartPos
    AddConnection(ToggleFrame.InputBegan, function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            toggleDragging = true
            toggleDragStart = input.Position
            toggleStartPos = ToggleFrame.Position
        end
    end)

    AddConnection(ToggleFrame.InputChanged, function(input)
        if toggleDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - toggleDragStart
            ToggleFrame.Position = UDim2.new(toggleStartPos.X.Scale, toggleStartPos.X.Offset + delta.X, toggleStartPos.Y.Scale, toggleStartPos.Y.Offset + delta.Y)
        end
    end)

    AddConnection(ToggleFrame.InputEnded, function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            toggleDragging = false
        end
    end)

    -- [[ NOTIFICATION SYSTEM ]] --
    local function Notify(title, text)
        if not MainGui.Parent then return end
        local n = Instance.new("Frame", MainGui)
        n.Size = UDim2.new(0, 220, 0, 50); n.BackgroundColor3 = Color3.fromRGB(15, 15, 18)
        n.Position = UDim2.new(1, 10, 0.8, 0); Instance.new("UICorner", n)
        local stroke = Instance.new("UIStroke", n); stroke.Color = ACCENT_COLOR; stroke.Thickness = 1
        
        local t = Instance.new("TextLabel", n)
        t.Text = title; t.Size = UDim2.new(1, -20, 0, 25); t.Position = UDim2.new(0, 10, 0, 5)
        t.TextColor3 = ACCENT_COLOR; t.Font = "GothamBold"; t.TextSize = 13; t.BackgroundTransparency = 1; t.TextXAlignment = "Left"
        
        local d = Instance.new("TextLabel", n)
        d.Text = text; d.Size = UDim2.new(1, -20, 0, 20); d.Position = UDim2.new(0, 10, 0, 22)
        d.TextColor3 = Color3.new(1,1,1); d.Font = "Gotham"; d.TextSize = 10; d.BackgroundTransparency = 1; d.TextXAlignment = "Left"
        
        ts:Create(n, TweenInfo.new(0.4, Enum.EasingStyle.Back), {Position = UDim2.new(1, -230, 0.8, 0)}):Play()
        task.delay(3, function()
            if n and n.Parent then
                ts:Create(n, TweenInfo.new(0.4), {Position = UDim2.new(1, 10, 0.8, 0)}):Play()
                task.wait(0.5); if n then n:Destroy() end
            end
        end)
    end

    -- [[ OUTPUT CONSOLE ]] --
    local OutputFrame = Instance.new("ScrollingFrame", Main)
    OutputFrame.Name = "LogConsole"
    OutputFrame.Size = UDim2.new(1, -240, 0, 80); OutputFrame.Position = UDim2.new(0, 230, 1, -95)
    OutputFrame.BackgroundColor3 = Color3.fromRGB(16, 16, 18); OutputFrame.BorderSizePixel = 0; OutputFrame.ScrollBarThickness = 2
    Instance.new("UICorner", OutputFrame)
    local OutputLayout = Instance.new("UIListLayout", OutputFrame); OutputLayout.Padding = UDim.new(0, 2)

    local function Log(text)
        if not OutputFrame.Parent then return end
        local l = Instance.new("TextLabel", OutputFrame)
        l.Size = UDim2.new(1, -10, 0, 18); l.BackgroundTransparency = 1; l.TextColor3 = Color3.fromRGB(200, 200, 200)
        l.Font = "Code"; l.TextSize = 11; l.Text = " > " .. text; l.TextXAlignment = "Left"
        OutputFrame.CanvasSize = UDim2.new(0, 0, 0, OutputLayout.AbsoluteContentSize.Y)
        OutputFrame.CanvasPosition = Vector2.new(0, OutputLayout.AbsoluteContentSize.Y)
    end

    -- [[ MAIN DRAGGABLE ]] --
    local dragging, dragStart, startPos
    AddConnection(Main.InputBegan, function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) and canDrag then
            dragging = true; dragStart = input.Position; startPos = Main.Position
        end
    end)
    AddConnection(uis.InputChanged, function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    AddConnection(uis.InputEnded, function(input) 
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then 
            dragging = false 
        end 
    end)

    -- [[ HEADER ]] --
    local Header = Instance.new("Frame", Main)
    Header.Size = UDim2.new(1, 0, 0, 40); Header.BackgroundTransparency = 1
    local Title = Instance.new("TextLabel", Header)
    Title.Text = "Pharmacii Hub"; Title.TextColor3 = ACCENT_COLOR; Title.Font = "GothamBold"; Title.TextSize = 16; Title.Size = UDim2.new(0, 200, 1, 0); Title.Position = UDim2.new(0, 30, 0, 0); Title.TextXAlignment = "Left"; Title.BackgroundTransparency = 1

    -- [[ CLOSE BUTTON ]] --
    local CloseBtn = Instance.new("TextButton", Header)
    CloseBtn.Size = UDim2.new(0, 24, 0, 24)
    CloseBtn.Position = UDim2.new(1, -34, 0, 8)
    CloseBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    CloseBtn.Text = "X"
    CloseBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
    CloseBtn.Font = "GothamBold"; CloseBtn.TextSize = 14
    Instance.new("UICorner", CloseBtn).CornerRadius = UDim.new(0, 4)
    AddConnection(CloseBtn.MouseButton1Click, FullDestruction)

    -- [[ SIDEBAR & SEARCH ]] --
    local Sidebar = Instance.new("Frame", Main)
    Sidebar.Size = UDim2.new(0, 220, 1, -40); Sidebar.Position = UDim2.new(0, 0, 0, 40); Sidebar.BackgroundTransparency = 1

    local SearchBoxFrame = Instance.new("Frame", Sidebar)
    SearchBoxFrame.Size = UDim2.new(0, 190, 0, 32); SearchBoxFrame.Position = UDim2.new(0.5, -95, 0, 10)
    SearchBoxFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 20); Instance.new("UICorner", SearchBoxFrame).CornerRadius = UDim.new(0, 6)

    local SearchIcon = Instance.new("ImageLabel", SearchBoxFrame)
    SearchIcon.Size = UDim2.new(0, 16, 0, 16); SearchIcon.Position = UDim2.new(0, 10, 0.5, -8)
    SearchIcon.BackgroundTransparency = 1; SearchIcon.Image = "rbxassetid://6031154871"
    SearchIcon.ImageColor3 = ACCENT_COLOR; SearchIcon.ImageTransparency = 0.3

    local SearchBox = Instance.new("TextBox", SearchBoxFrame)
    SearchBox.Size = UDim2.new(1, -35, 1, 0); SearchBox.Position = UDim2.new(0, 32, 0, 0)
    SearchBox.BackgroundTransparency = 1; SearchBox.TextColor3 = Color3.new(1,1,1); SearchBox.PlaceholderText = "Search features..."
    SearchBox.Font = "Gotham"; SearchBox.TextSize = 12; SearchBox.PlaceholderColor3 = Color3.fromRGB(80, 80, 80); SearchBox.TextXAlignment = "Left"

    -- [[ PROFILE SECTION ]] --
    local ProfileFrame = Instance.new("Frame", Sidebar)
    ProfileFrame.Size = UDim2.new(1, -20, 0, 50)
    ProfileFrame.Position = UDim2.new(0, 10, 1, -60) 
    ProfileFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 20)
    Instance.new("UICorner", ProfileFrame).CornerRadius = UDim.new(0, 6)
    local pStroke = Instance.new("UIStroke", ProfileFrame); pStroke.Color = Color3.fromRGB(30,30,35); pStroke.Thickness = 1

    local Avatar = Instance.new("ImageLabel", ProfileFrame)
    Avatar.Size = UDim2.new(0, 34, 0, 34); Avatar.Position = UDim2.new(0, 8, 0.5, -17)
    Avatar.BackgroundTransparency = 1
    Instance.new("UICorner", Avatar).CornerRadius = UDim.new(1, 0)
    task.spawn(function()
        Avatar.Image = game:GetService("Players"):GetUserThumbnailAsync(p.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
    end)

    local PName = Instance.new("TextLabel", ProfileFrame)
    PName.Text = p.DisplayName; PName.Size = UDim2.new(1, -55, 0, 18); PName.Position = UDim2.new(0, 50, 0, 8)
    PName.TextColor3 = Color3.new(1,1,1); PName.Font = "GothamBold"; PName.TextSize = 12; PName.TextXAlignment = "Left"; PName.BackgroundTransparency = 1

    local PUser = Instance.new("TextLabel", ProfileFrame)
    PUser.Text = "@" .. p.Name; PUser.Size = UDim2.new(1, -55, 0, 15); PUser.Position = UDim2.new(0, 50, 0, 24)
    PUser.TextColor3 = Color3.fromRGB(150, 150, 155); PUser.Font = "Gotham"; PUser.TextSize = 10; PUser.TextXAlignment = "Left"; PUser.BackgroundTransparency = 1

    local TabScroller = Instance.new("ScrollingFrame", Sidebar)
    TabScroller.Size = UDim2.new(1, 0, 1, -210); TabScroller.Position = UDim2.new(0, 0, 0, 55); TabScroller.BackgroundTransparency = 1; TabScroller.ScrollBarThickness = 0
    local TabLayout = Instance.new("UIListLayout", TabScroller); TabLayout.Padding = UDim.new(0, 5); TabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

    -- [[ TABS SYSTEM ]] --
    local Pages = Instance.new("Frame", Main)
    Pages.Size = UDim2.new(1, -240, 1, -160); Pages.Position = UDim2.new(0, 230, 0, 50); Pages.BackgroundTransparency = 1

    local function AddTab(name, subtext, iconId, isSettings)
        local Page = Instance.new("ScrollingFrame", Pages); Page.Size = UDim2.new(1, 0, 1, 0); Page.Visible = false; Page.BackgroundTransparency = 1; Page.ScrollBarThickness = 0
        Instance.new("UIListLayout", Page).Padding = UDim.new(0, 10)
        
        local Btn = Instance.new("TextButton"); Btn.Size = UDim2.new(0, 200, 0, 50); Btn.BackgroundColor3 = Color3.fromRGB(16, 16, 18); Btn.Text = ""; Instance.new("UICorner", Btn)
        Btn.Name = name
        
        local Icon = Instance.new("ImageLabel", Btn); Icon.Size = UDim2.new(0, 24, 0, 24); Icon.Position = UDim2.new(0, 12, 0.5, -12); Icon.BackgroundTransparency = 1
        Icon.Image = "rbxthumb://type=Asset&id=" .. tostring(iconId) .. "&w=420&h=420"
        Icon.ImageColor3 = ACCENT_COLOR; Icon.ZIndex = 5

        local L = Instance.new("TextLabel", Btn); L.Text = name; L.Size = UDim2.new(1, -55, 0, 25); L.Position = UDim2.new(0, 45, 0, 5); L.TextColor3 = Color3.new(1,1,1); L.Font = "GothamBold"; L.TextSize = 13; L.TextXAlignment = "Left"; L.BackgroundTransparency = 1
        local S = Instance.new("TextLabel", Btn); S.Text = subtext; S.Size = UDim2.new(1, -55, 0, 15); S.Position = UDim2.new(0, 45, 0, 23); S.TextColor3 = Color3.fromRGB(150, 150, 155); S.Font = "Gotham"; S.TextSize = 10; S.TextXAlignment = "Left"; S.BackgroundTransparency = 1
        
        Btn.Parent = isSettings and Sidebar or TabScroller
        if isSettings then Btn.Position = UDim2.new(0.5, -100, 1, -115) end
        
        AddConnection(Btn.MouseButton1Click, function()
            if activeTabBtn then ts:Create(activeTabBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(16, 16, 18)}):Play() end
            activeTabBtn = Btn; ts:Create(Btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(35, 35, 38)}):Play()
            for _, pge in pairs(Pages:GetChildren()) do if pge:IsA("ScrollingFrame") then pge.Visible = false end end Page.Visible = true
        end)
        return Page
    end

    -- [[ TABS WITH ASSET IDS ]] --
    local CatchTab    = AddTab("Catching", "Magnets, etc", 111445466690589)
    local PhysicsTab  = AddTab("Physics", "Blocking, etc", 120444841204590)
    local AutoTab     = AddTab("Automatics", "Rush, guard", 125394931343127)
    local PlayerTab   = AddTab("Player", "Jumppower, etc", 76096928624044)
    local ThrowTab    = AddTab("Throwing", "QB, etc", 88473943240732)
    local MiscTab     = AddTab("Misc", "No Bounds, etc", 123728818726021)
    local SettingsTab = AddTab("Settings", "Configuration", 96926477160025, true)

    -- [[ SEARCH LOGIC ]] --
    AddConnection(SearchBox:GetPropertyChangedSignal("Text"), function()
        local input = string.lower(SearchBox.Text)
        for _, btn in pairs(TabScroller:GetChildren()) do
            if btn:IsA("TextButton") then
                local subtext = btn:FindFirstChildOfClass("TextLabel") and btn:FindFirstChildOfClass("TextLabel").Text or ""
                btn.Visible = (string.find(string.lower(btn.Name), input) or string.find(string.lower(subtext), input))
            end
        end
    end)

    -- [[ FEATURE BUILDERS ]] --
    local function CreateMagnetNested(parent)
        local Container = Instance.new("Frame", parent); Container.Size = UDim2.new(1, -20, 0, 60); Container.BackgroundColor3 = Color3.fromRGB(16, 16, 18); Container.ClipsDescendants = true; Instance.new("UICorner", Container)
        local Label = Instance.new("TextLabel", Container); Label.Text = "Ball Magnet"; Label.Size = UDim2.new(0.6, 0, 0, 60); Label.Position = UDim2.new(0, 20, 0, 0); Label.TextColor3 = Color3.new(1,1,1); Label.Font = "GothamBold"; Label.TextSize = 13; Label.TextXAlignment = "Left"; Label.BackgroundTransparency = 1
        local Toggle = Instance.new("TextButton", Container); Toggle.Size = UDim2.new(0, 36, 0, 18); Toggle.Position = UDim2.new(1, -50, 0, 21); Toggle.BackgroundColor3 = Color3.fromRGB(45, 45, 48); Toggle.Text = ""; Instance.new("UICorner", Toggle).CornerRadius = UDim.new(1, 0)
        local Dot = Instance.new("Frame", Toggle); Dot.Size = UDim2.new(0, 14, 0, 14); Dot.Position = UDim2.new(0, 2, 0.5, -7); Dot.BackgroundColor3 = Color3.new(1,1,1); Instance.new("UICorner", Dot).CornerRadius = UDim.new(1, 0)
        local Dropdown = Instance.new("Frame", Container); Dropdown.Size = UDim2.new(1, -40, 0, 100); Dropdown.Position = UDim2.new(0, 20, 0, 60); Dropdown.BackgroundTransparency = 1
        local SLabel = Instance.new("TextLabel", Dropdown); SLabel.Text = "Catch Range: " .. _G.MagRange; SLabel.Size = UDim2.new(1,0,0,15); SLabel.TextColor3 = Color3.fromRGB(150, 150, 155); SLabel.Font = "Gotham"; SLabel.TextSize = 11; SLabel.BackgroundTransparency = 1; SLabel.TextXAlignment = "Left"
        local Bg = Instance.new("Frame", Dropdown); Bg.Size = UDim2.new(1, 0, 0, 6); Bg.Position = UDim2.new(0, 0, 0, 25); Bg.BackgroundColor3 = Color3.fromRGB(40, 40, 42); Instance.new("UICorner", Bg)
        local Fill = Instance.new("Frame", Bg); Fill.Size = UDim2.new(_G.MagRange/50, 0, 1, 0); Fill.BackgroundColor3 = ACCENT_COLOR; Instance.new("UICorner", Fill)
        local VisToggle = Instance.new("TextButton", Dropdown); VisToggle.Size = UDim2.new(0, 30, 0, 15); VisToggle.Position = UDim2.new(1, -30, 0, 52); VisToggle.BackgroundColor3 = Color3.fromRGB(45, 45, 48); VisToggle.Text = ""; Instance.new("UICorner", VisToggle).CornerRadius = UDim.new(1, 0)
        local VisDot = Instance.new("Frame", VisToggle); VisDot.Size = UDim2.new(0, 11, 0, 11); VisDot.Position = UDim2.new(0, 2, 0.5, -5.5); VisDot.BackgroundColor3 = Color3.new(1,1,1); Instance.new("UICorner", VisDot).CornerRadius = UDim.new(1, 0)
        local VisLbl = Instance.new("TextLabel", Dropdown); VisLbl.Text = "Show Hitboxes"; VisLbl.Size = UDim2.new(0, 100, 0, 15); VisLbl.Position = UDim2.new(1, -135, 0, 52); VisLbl.TextColor3 = Color3.fromRGB(150, 150, 155); VisLbl.Font = "Gotham"; VisLbl.TextSize = 11; VisLbl.BackgroundTransparency = 1; VisLbl.TextXAlignment = "Right"
        
        local function UpdateMag(val)
            MagnetEnabled = val
            ts:Create(Container, TweenInfo.new(0.3), {Size = UDim2.new(1, -20, 0, MagnetEnabled and 150 or 60)}):Play()
            ts:Create(Toggle, TweenInfo.new(0.2), {BackgroundColor3 = MagnetEnabled and ACCENT_COLOR or Color3.fromRGB(45, 45, 48)}):Play()
            ts:Create(Dot, TweenInfo.new(0.2), {Position = MagnetEnabled and UDim2.new(1, -17, 0.5, -7) or UDim2.new(0, 2, 0.5, -7)}):Play()
        end
        
        -- [[ MOBILE SLIDER SUPPORT ]] --
        AddConnection(Bg.InputBegan, function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                canDrag = false
                local move; move = AddConnection(uis.InputChanged, function(m)
                    if m.UserInputType == Enum.UserInputType.MouseMovement or m.UserInputType == Enum.UserInputType.Touch then
                        local pos = math.clamp((m.Position.X - Bg.AbsolutePosition.X) / Bg.AbsoluteSize.X, 0, 1)
                        Fill.Size = UDim2.new(pos, 0, 1, 0)
                        _G.MagRange = math.floor(pos * 50); SLabel.Text = "Catch Range: " .. _G.MagRange
                    end
                end)
                local endCon; endCon = AddConnection(uis.InputEnded, function(up) 
                    if up.UserInputType == Enum.UserInputType.MouseButton1 or up.UserInputType == Enum.UserInputType.Touch then 
                        move:Disconnect(); endCon:Disconnect(); canDrag = true 
                    end 
                end)
            end
        end)
        
        AddConnection(Toggle.MouseButton1Click, function() UpdateMag(not MagnetEnabled) end)
        AddConnection(VisToggle.MouseButton1Click, function()
            VisualsEnabled = not VisualsEnabled
            ts:Create(VisToggle, TweenInfo.new(0.2), {BackgroundColor3 = VisualsEnabled and ACCENT_COLOR or Color3.fromRGB(45, 45, 48)}):Play()
            ts:Create(VisDot, TweenInfo.new(0.2), {Position = VisualsEnabled and UDim2.new(1, -14, 0.5, -5.5) or UDim2.new(0, 2, 0.5, -5.5)}):Play()
        end)
        
        FeatureRegistry["Magnet"] = {
            SetState = function(s) if s ~= MagnetEnabled then UpdateMag(s) end end,
            GetState = function() return MagnetEnabled end,
            SetValue = function(v) _G.MagRange = v; SLabel.Text = "Catch Range: "..v; Fill.Size = UDim2.new(v/50, 0, 1, 0) end,
            GetValue = function() return _G.MagRange end
        }
    end

    local function CreateButton(parent, title, callback)
        local Container = Instance.new("Frame", parent); Container.Size = UDim2.new(1, -20, 0, 50); Container.BackgroundColor3 = Color3.fromRGB(16, 16, 18); Instance.new("UICorner", Container)
        local Label = Instance.new("TextLabel", Container); Label.Text = title; Label.Size = UDim2.new(0.6, 0, 1, 0); Label.Position = UDim2.new(0, 20, 0, 0); Label.TextColor3 = Color3.new(1,1,1); Label.Font = "GothamBold"; Label.TextSize = 13; Label.TextXAlignment = "Left"; Label.BackgroundTransparency = 1
        local Btn = Instance.new("TextButton", Container); Btn.Size = UDim2.new(0, 100, 0, 30); Btn.Position = UDim2.new(1, -110, 0.5, -15); Btn.BackgroundColor3 = Color3.fromRGB(45, 45, 48); Btn.Text = "Click"; Btn.TextColor3 = Color3.new(1,1,1); Btn.Font = "GothamBold"; Btn.TextSize = 11; Instance.new("UICorner", Btn)
        
        AddConnection(Btn.MouseButton1Click, function()
            ts:Create(Btn, TweenInfo.new(0.1), {BackgroundColor3 = ACCENT_COLOR}):Play()
            task.wait(0.1)
            ts:Create(Btn, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(45, 45, 48)}):Play()
            callback(Btn)
        end)
    end

    local function CreateFeature(parent, title, subText, hasSlider, defaultVal, maxVal, typeKey, callback)
        local Container = Instance.new("Frame", parent); Container.Size = UDim2.new(1, -20, 0, 60); Container.BackgroundColor3 = Color3.fromRGB(16, 16, 18); Container.ClipsDescendants = true; Instance.new("UICorner", Container)
        local Label = Instance.new("TextLabel", Container); Label.Text = title; Label.Size = UDim2.new(0.6, 0, 0, 60); Label.Position = UDim2.new(0, 20, 0, 0); Label.TextColor3 = Color3.new(1,1,1); Label.Font = "GothamBold"; Label.TextSize = 13; Label.TextXAlignment = "Left"; Label.BackgroundTransparency = 1
        local Toggle = Instance.new("TextButton", Container); Toggle.Size = UDim2.new(0, 36, 0, 18); Toggle.Position = UDim2.new(1, -50, 0, 21); Toggle.BackgroundColor3 = Color3.fromRGB(45, 45, 48); Toggle.Text = ""; Instance.new("UICorner", Toggle).CornerRadius = UDim.new(1, 0)
        local Dot = Instance.new("Frame", Toggle); Dot.Size = UDim2.new(0, 14, 0, 14); Dot.Position = UDim2.new(0, 2, 0.5, -7); Dot.BackgroundColor3 = Color3.new(1,1,1); Instance.new("UICorner", Dot).CornerRadius = UDim.new(1, 0)
        
        local CurrentValue = defaultVal 
        local SliderFunc = nil
        if hasSlider then
            local SliderFrame = Instance.new("Frame", Container); SliderFrame.Size = UDim2.new(1, -40, 0, 40); SliderFrame.Position = UDim2.new(0, 20, 0, 60); SliderFrame.BackgroundTransparency = 1
            local SLabel = Instance.new("TextLabel", SliderFrame); SLabel.Text = subText .. ": " .. defaultVal; SLabel.Size = UDim2.new(1,0,0,15); SLabel.TextColor3 = Color3.fromRGB(150, 150, 155); SLabel.Font = "Gotham"; SLabel.TextSize = 11; SLabel.BackgroundTransparency = 1; SLabel.TextXAlignment = "Left"
            local Bg = Instance.new("Frame", SliderFrame); Bg.Size = UDim2.new(1, 0, 0, 6); Bg.Position = UDim2.new(0, 0, 0, 25); Bg.BackgroundColor3 = Color3.fromRGB(40, 40, 42); Instance.new("UICorner", Bg)
            local Fill = Instance.new("Frame", Bg); Fill.Size = UDim2.new(defaultVal/maxVal, 0, 1, 0); Fill.BackgroundColor3 = ACCENT_COLOR; Instance.new("UICorner", Fill)
            
            SliderFunc = function(val)
                CurrentValue = val 
                Fill.Size = UDim2.new(val/maxVal, 0, 1, 0)
                SLabel.Text = subText .. ": " .. val
                
                if typeKey == "Time" then 
                    _G.CustomTime = val
                    local feat = FeatureRegistry[typeKey]
                    if feat and feat.GetState() then game:GetService("Lighting").ClockTime = val end
                elseif typeKey == "Bright" then
                    _G.CustomBright = val
                    local feat = FeatureRegistry[typeKey]
                    if feat and feat.GetState() then game:GetService("Lighting").Brightness = val end
                elseif typeKey == "Predict" then 
                    _G.QBPrediction = val
                elseif typeKey == "HBE" then 
                    _G.HBESize = val
                else
                    callback(val)
                end
            end

            -- [[ MOBILE SLIDER SUPPORT ]] --
            AddConnection(Bg.InputBegan, function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    canDrag = false
                    local move; move = AddConnection(uis.InputChanged, function(m)
                        if m.UserInputType == Enum.UserInputType.MouseMovement or m.UserInputType == Enum.UserInputType.Touch then
                            local pos = math.clamp((m.Position.X - Bg.AbsolutePosition.X) / Bg.AbsoluteSize.X, 0, 1)
                            local val = math.floor(pos * maxVal)
                            SliderFunc(val)
                        end
                    end)
                    local endCon; endCon = AddConnection(uis.InputEnded, function(up) 
                        if up.UserInputType == Enum.UserInputType.MouseButton1 or up.UserInputType == Enum.UserInputType.Touch then 
                            move:Disconnect(); endCon:Disconnect(); canDrag = true 
                        end 
                    end)
                end
            end)
        end
        
        local active = false
        local function UpdateState(state)
            active = state
            
            -- Feature Toggle Logic
            if typeKey == "Tuck" then AutoTuckEnabled = active
            elseif typeKey == "HBE" then HBEEnabled = active 
            elseif typeKey == "Block" then 
                AdvancedBlocking = active
                if not active then -- RESET HITBOXES
                    for _, player in pairs(game:GetService("Players"):GetPlayers()) do
                        if player ~= p and player.Character then
                            local jersey = player.Character:FindFirstChild("Jersey") or player.Character:FindFirstChild("Hitbox")
                            if jersey then jersey.Size = Vector3.new(2.31, 5.4, 2.3) end
                        end
                    end
                end
            elseif typeKey == "InfJump" then _G.InfiniteJump = active
            elseif typeKey == "Noclip" then 
                NoclipEnabled = active
                if not active and p.Character then 
                    local bodyParts = {"Head", "HumanoidRootPart", "UpperTorso", "LowerTorso", "Torso"}
                    for _, name in pairs(bodyParts) do
                        local part = p.Character:FindFirstChild(name)
                        if part then part.CanCollide = true end
                    end
                end
            elseif typeKey == "Speed" then 
                WalkspeedEnabled = active
                if not active and p.Character then
                    local h = p.Character:FindFirstChildOfClass("Humanoid")
                    if h then h.WalkSpeed = 16 end
                end
            elseif typeKey == "Power" then 
                JumppowerEnabled = active
                if not active and p.Character then
                    local h = p.Character:FindFirstChildOfClass("Humanoid")
                    if h then h.JumpPower = 50 end
                end
            elseif typeKey == "QBFollow" then 
                QBFollowEnabled = active
                if not active then isFollowing = false end
            elseif typeKey == "Truck" then 
                TruckingEnabled = active 
            elseif typeKey == "AntiKnock" then 
                AntiKnockbackEnabled = active
                if not active and p.Character then
                    local l = p.Character:FindFirstChild("Left Arm"); local r = p.Character:FindFirstChild("Right Arm")
                    if l then l.Size = Vector3.new(1,2,1) end
                    if r then r.Size = Vector3.new(1,2,1) end
                end
            elseif typeKey == "BigHead" then 
                BigHeadEnabled = active
                if not active then
                    for _,v in pairs(game.Players:GetPlayers()) do
                        if v.Character and v.Character:FindFirstChild("Head") then
                            v.Character.Head.Size = Vector3.new(2,1,1)
                            v.Character.Head.Transparency = 0
                        end
                    end
                end
            elseif typeKey == "ShowHB" then 
                ShowAllHitboxes = active
                if not active then
                    for _, player in pairs(game:GetService("Players"):GetPlayers()) do
                        if player ~= p and player.Character then
                            local jersey = player.Character:FindFirstChild("Jersey") or player.Character:FindFirstChild("Hitbox")
                            if jersey then jersey.Transparency = 1 end
                        end
                    end
                end
            elseif typeKey == "AutoTackle" then AutoTackleEnabled = active
            elseif typeKey == "QBAim" then 
                QBAimbotEnabled = active
                if active then Notify("Info", "Hold Right Click to Aim") end
            elseif typeKey == "Time" then 
                game:GetService("Lighting").ClockTime = active and _G.CustomTime or OriginTime
            elseif typeKey == "Bright" then 
                game:GetService("Lighting").Brightness = active and _G.CustomBright or OriginBright
            end
            
            ts:Create(Container, TweenInfo.new(0.3), {Size = UDim2.new(1, -20, 0, (active and hasSlider) and 120 or 60)}):Play()
            ts:Create(Toggle, TweenInfo.new(0.2), {BackgroundColor3 = active and ACCENT_COLOR or Color3.fromRGB(45, 45, 48)}):Play()
            ts:Create(Dot, TweenInfo.new(0.2), {Position = active and UDim2.new(1, -17, 0.5, -7) or UDim2.new(0, 2, 0.5, -7)}):Play()
            if state then Notify(title, "Enabled") else Notify(title, "Disabled") end
        end
        
        AddConnection(Toggle.MouseButton1Click, function() UpdateState(not active) end)
        
        FeatureRegistry[typeKey] = {
            SetState = UpdateState,
            GetState = function() return active end,
            SetValue = SliderFunc,
            GetValue = function() return CurrentValue end 
        }
    end

    -- [[ CONFIGURATION SYSTEM ]] --
    local ConfigName = "PharmaciiConfig.json"

    local function SaveConfig()
        if not writefile then Notify("Error", "Executor not supported"); return end
        
        local data = {}
        for key, feat in pairs(FeatureRegistry) do
            data[key] = {
                Enabled = feat.GetState(),
                Value = (feat.GetValue and feat.GetValue() or 0)
            }
        end
        writefile(ConfigName, http:JSONEncode(data))
        Notify("Config", "Saved Successfully")
    end

    local function LoadConfig()
        if not isfile or not readfile then Notify("Error", "Executor not supported"); return end

        if isfile(ConfigName) then
            local data = http:JSONDecode(readfile(ConfigName))
            for key, setting in pairs(data) do
                if FeatureRegistry[key] then
                    FeatureRegistry[key].SetState(setting.Enabled)
                    if setting.Value and FeatureRegistry[key].SetValue then
                        FeatureRegistry[key].SetValue(setting.Value)
                    end
                end
            end
            Notify("Config", "Loaded Successfully")
        else
            Notify("Config", "No Save File Found")
        end
    end

    -- [[ INITIALIZE FEATURES ]] --
    CreateMagnetNested(CatchTab)
    CreateFeature(CatchTab, "Auto Tuck", "Delay (ms)", true, 50, 500, "Tuck", function(v) _G.TuckSpeed = v end)
    CreateFeature(PhysicsTab, "Advanced Blocking", "Resize Enemies", false, 0, 0, "Block", function() end) 
    CreateFeature(PhysicsTab, "Enhanced Trucking", "Press 'F'", false, 0, 0, "Truck", function() end) 
    CreateFeature(PhysicsTab, "Anti-Knockback", "Expand Arms", false, 0, 0, "AntiKnock", function() end) 
    CreateFeature(PhysicsTab, "Big Head All", "Expand Heads", false, 0, 0, "BigHead", function() end) 
    CreateFeature(AutoTab, "QB Follow", "Press 'R' to toggle", false, 0, 0, "QBFollow", function() end) 
    CreateFeature(AutoTab, "Auto Tackle", "Teleport to Ball", false, 0, 0, "AutoTackle", function() end) 
    CreateFeature(ThrowTab, "QB Aimbot", "Right Click", false, 0, 0, "QBAim", function() end)
    CreateFeature(ThrowTab, "Prediction", "Lead Amount", true, 10, 50, "Predict", function(v) _G.QBPrediction = v end)
    CreateFeature(PlayerTab, "Walkspeed", "Speed", true, 16, 250, "Speed", function(v) _G.WalkSpeed = v end)
    CreateFeature(PlayerTab, "JumpPower", "Power", true, 50, 500, "Power", function(v) _G.JumpPower = v end)
    CreateFeature(PlayerTab, "Infinite Jump", "Air Walk", false, 0, 0, "InfJump", function() end)
    CreateFeature(PlayerTab, "Noclip", "No Walls", false, 0, 0, "Noclip", function() end)
    CreateFeature(MiscTab, "HBE (Self)", "Size", true, 5, 50, "HBE", function(v) _G.HBESize = v end) 
    CreateFeature(MiscTab, "No Bounds", "Remove Walls", false, 0, 0, "NoBounds", function() end)

    -- [[ SETTINGS ]] --
    CreateButton(SettingsTab, "Infinite Yield", function() loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))() end)
    CreateButton(SettingsTab, "Rejoin Server", function() tps:Teleport(game.PlaceId, p) end)
    CreateFeature(SettingsTab, "Visible All Hitboxes", "See Everyone", false, 0, 0, "ShowHB", function() end)
    CreateFeature(SettingsTab, "World Time", "Clock Time", true, 12, 24, "Time", function(v) end) 
    CreateFeature(SettingsTab, "Brightness", "Light Level", true, 2, 10, "Bright", function(v) end)

    -- SAVE/LOAD BUTTONS
    CreateButton(SettingsTab, "Save Config", SaveConfig)
    CreateButton(SettingsTab, "Load Config", LoadConfig)

    -- KEYBIND CHANGER
    local ChangingKey = false
    local KeyButton = nil
    CreateButton(SettingsTab, "Change UI Keybind", function(btn)
        ChangingKey = true
        KeyButton = btn
        btn.Text = "Press Key..."
    end)

    AddConnection(uis.InputBegan, function(input)
        if ChangingKey and input.UserInputType == Enum.UserInputType.Keyboard then
            _G.HideKey = input.KeyCode
            ChangingKey = false
            if KeyButton then KeyButton.Text = "Bind: " .. input.KeyCode.Name end
            Notify("Keybind", "Set to " .. input.KeyCode.Name)
        end
    end)

    -- [[ ONE-CLICK MAGNET INPUT ]] --
    AddConnection(uis.InputBegan, function(input, g)
        if not g and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
            local char = p.Character
            local hasBall = char and (char:FindFirstChild("Football") or char:FindFirstChild("Ball"))
            if not hasBall then
                MagnetActiveTime = tick() + MAGNET_LATCH_DURATION
            end
        end
    end)

    -- [[ LOGIC LOOPS ]] --
    -- [[ FIXED AUTO TUCK LOOP - ONE PRESS ONLY ]] --
    local hasTucked = false
    task.spawn(function()
        while MainGui.Parent do 
            if AutoTuckEnabled then
                local char = p.Character
                if char then
                    local ball = char:FindFirstChild("Football") or char:FindFirstChild("Ball")
                    if ball then
                        if not hasTucked then
                            task.wait(_G.TuckSpeed / 1000) 
                            pcall(function()
                                vim:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                                task.wait(0.05)
                                vim:SendKeyEvent(false, Enum.KeyCode.E, false, game)
                            end)
                            hasTucked = true
                            Log("Auto Tuck Executed")
                        end
                    else
                        hasTucked = false
                    end
                else
                    task.wait(0.5)
                end
            else
                task.wait(0.5)
            end
            task.wait(0.1)
        end
    end)

    -- [[ SMOOTHER PHYSICS (RenderStepped) ]] --
    AddConnection(rs.RenderStepped, function()
        local char = p.Character
        if not char then return end
        
        if MagnetEnabled then
            local hasBall = char:FindFirstChild("Football") or char:FindFirstChild("Ball")
            if not hasBall then
                local isCatching = (tick() < MagnetActiveTime) or uis:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) or uis:IsGamepadButtonDown(Enum.UserInputType.Gamepad1, Enum.KeyCode.ButtonR2)
                local hand = char:FindFirstChild("RightHand") or char:FindFirstChild("Right Arm")
                if isCatching and hand then
                    for _, obj in pairs(workspace:GetChildren()) do
                        if (obj.Name == "Football" or obj.Name == "Ball") and obj:IsA("BasePart") then
                            local dist = (obj.Position - hand.Position).Magnitude
                            if dist <= _G.MagRange then
                                obj.AssemblyLinearVelocity = Vector3.zero
                                obj.RotVelocity = Vector3.zero
                                obj.CFrame = hand.CFrame * CFrame.new(0, -0.85, 0)
                            end
                        end
                    end
                end
            end
        end
        
        if QBAimbotEnabled then
            local tool = char:FindFirstChild("Football") or char:FindFirstChild("Ball")
            if tool and uis:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
                local closest, closestDist = nil, math.huge
                local mousePos = uis:GetMouseLocation()
                for _, v in pairs(game.Players:GetPlayers()) do
                    if v ~= p and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                        local screenPos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(v.Character.HumanoidRootPart.Position)
                        if onScreen then
                            local dist = (Vector2.new(mousePos.X, mousePos.Y) - Vector2.new(screenPos.X, screenPos.Y)).Magnitude
                            if dist < closestDist then closest = v; closestDist = dist end
                        end
                    end
                end
                if closest then
                    local hrp = closest.Character.HumanoidRootPart
                    local predictedPos = hrp.Position + (hrp.Velocity * (_G.QBPrediction / 100))
                    workspace.CurrentCamera.CFrame = CFrame.lookAt(workspace.CurrentCamera.CFrame.Position, predictedPos)
                end
            end
        end
    end)

    -- Heartbeat
    AddConnection(rs.Heartbeat, function()
        local char = p.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        
        if hum then
            if WalkspeedEnabled and hum.WalkSpeed ~= _G.WalkSpeed then hum.WalkSpeed = _G.WalkSpeed end
            if JumppowerEnabled and hum.JumpPower ~= _G.JumpPower then hum.JumpPower = _G.JumpPower end
        end

        if NoclipEnabled and char then 
            for _, v in pairs(char:GetDescendants()) do 
                if v:IsA("BasePart") then v.CanCollide = false end 
            end
        end
        
        if MagnetEnabled and VisualsEnabled and char and char:FindFirstChild("HumanoidRootPart") then
            VisualPart.CFrame = char.HumanoidRootPart.CFrame
            VisualPart.Size = Vector3.new(_G.MagRange, _G.MagRange, _G.MagRange)
            SelectionBox.Adornee = VisualPart
        else 
            SelectionBox.Adornee = nil 
        end

        if isFollowing and QBFollowEnabled then followPlayer() end
        if AutoTackleEnabled then autoTackle() end
        
        if TruckingEnabled and isTruckingHeld and char then
            local truckingValue = char:FindFirstChild("Trucking", true)
            if truckingValue then truckingValue.Value = true end
        end

        if AdvancedBlocking then
            for _, player in pairs(game:GetService("Players"):GetPlayers()) do
                local character = player.Character
                if character and character.Name ~= p.Name then
                    local jersey = character:FindFirstChild("Jersey") or character:FindFirstChild("Hitbox")
                    if jersey then jersey.Size = Vector3.new(10, 10, 10) end
                end
            end
        end
        
        if HBEEnabled and char then
            local hb = char:FindFirstChild("Hitbox") or char:FindFirstChild("Jersey") or char:FindFirstChild("HumanoidRootPart")
            if hb then hb.Size = Vector3.new(_G.HBESize, _G.HBESize, _G.HBESize) end
        end
        
        if ShowAllHitboxes then
            for _, player in pairs(game:GetService("Players"):GetPlayers()) do
                if player ~= p and player.Character then
                    local jersey = player.Character:FindFirstChild("Jersey") or player.Character:FindFirstChild("Hitbox")
                    if jersey then jersey.Transparency = 0.8 end
                end
            end
        end
        
        if AntiKnockbackEnabled and char then
            local lArm = char:FindFirstChild("Left Arm"); local rArm = char:FindFirstChild("Right Arm")
            if lArm and rArm then lArm.Size = Vector3.new(20,2,2); rArm.Size = Vector3.new(20,2,2) end
        end
        
        if BigHeadEnabled then
            for _,v in pairs(game.Players:GetPlayers()) do
                if v.Character and v.Character:FindFirstChild("Head") then
                    v.Character.Head.Size = Vector3.new(4,4,4)
                    v.Character.Head.Transparency = 1
                end
            end
        end
    end)

    AddConnection(uis.JumpRequest, function()
        if _G.InfiniteJump and p.Character then
            local hum = p.Character:FindFirstChildOfClass("Humanoid")
            if hum then hum:ChangeState(Enum.HumanoidStateType.Jumping) end
        end
    end)

    AddConnection(uis.InputBegan, function(i, g) 
        if not g then
            if i.KeyCode == _G.HideKey then Main.Visible = not Main.Visible 
            elseif i.KeyCode == Enum.KeyCode.R and QBFollowEnabled then isFollowing = not isFollowing; Log("Following: " .. (isFollowing and "On" or "Off"))
            elseif i.KeyCode == Enum.KeyCode.F and TruckingEnabled then
                isTruckingHeld = true
                local char = p.Character
                if char then
                    local jersey = char:FindFirstChild("Jersey")
                    if jersey then
                        local evt = jersey:FindFirstChild("Event")
                        if evt then evt:FireServer({[1] = "Truck"}) end
                    end
                end
            end
        end 
    end)

    AddConnection(uis.InputEnded, function(i, g)
        if i.KeyCode == Enum.KeyCode.F and TruckingEnabled then
            isTruckingHeld = false
            local char = p.Character
            if char then
                local jersey = char:FindFirstChild("Jersey")
                if jersey then
                    local evt = jersey:FindFirstChild("Event")
                    if evt then evt:FireServer({[1] = "StopTruck"}) end
                end
                local truckingValue = char:FindFirstChild("Trucking", true)
                if truckingValue then truckingValue.Value = false end
            end
        end
    end)

    -- Init
    for _, pg in pairs(Pages:GetChildren()) do pg.Visible = false end
    Pages:GetChildren()[1].Visible = true
    Log("Pharmacii Hub: https://discord.gg/P3MaHnCRjN.")

end

-- [[ 3. AUTHENTICATION LOGIC (Plain Text) ]] --
local function Authenticate()
    local success, response = pcall(function()
        return game:HttpGet(WHITELIST_URL .. "?t=" .. os.time())
    end)

    local isWhitelisted = false

    if success then
        for line in response:gmatch("[^\r\n]+") do
            -- Clean and check each line
            local cleanLine = line:gsub('["%[%],]', '') 
            local namePart = string.split(cleanLine, "|")[1]
            if namePart then
                namePart = namePart:match("^%s*(.-)%s*$")
                if namePart == Username then
                    isWhitelisted = true
                    break
                end
            end
        end
    end

    if isWhitelisted then
        -- RUN THE HUB
        RunPharmaciiHub()
    else
        warn("PHARMACII: Access Denied")
        setclipboard(Username)
        StarterGui:SetCore("SendNotification", {
            Title = "ACCESS DENIED",
            Text = "Username copied to clipboard.",
            Duration = 5
        })
    end
end

task.spawn(Authenticate)
