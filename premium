-- [[ CONFIG ]] --
local WHITELIST_URL = "https://raw.githubusercontent.com/jamalyoung373739-bit/whitelist.json/main/json"
local HUB_URL = "https://raw.githubusercontent.com/jamalyoung373739-bit/Pharmacii1f/main/Finale"

-- [[ 1. UNIVERSAL HWID GETTER ]] --
-- Tries gethwid() first (PC), falls back to ClientId (Mobile/Web)
local hwid = (gethwid and gethwid()) or game:GetService("RbxAnalyticsService"):GetClientId()
local HttpService = game:GetService("HttpService")

-- [[ 2. FORCE COPY & NOTIFY ]] --
-- Try to copy immediately
pcall(function() 
    if setclipboard then setclipboard(tostring(hwid)) end
    if toclipboard then toclipboard(tostring(hwid)) end
end)

-- Force message to F9 Console
print("------------------------------------------")
print("PHARMACII HUB AUTHENTICATION")
print("YOUR ID: " .. tostring(hwid))
print("ID HAS BEEN COPIED TO YOUR CLIPBOARD")
print("------------------------------------------")

-- Windows/Screen Pop-up
pcall(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "PHARMACII ID COPIED",
        Text = tostring(hwid),
        Duration = 10,
        Icon = "rbxassetid://6031154871" -- Optional Icon
    })
end)

-- Executor Console (if available)
if rconsoleprint then
    rconsoleprint("\nPHARMACII ID: " .. tostring(hwid) .. "\n")
    rconsoleprint("Copy the ID above and send it to amiri in ur ticket.\n")
end

-- [[ 3. AUTHENTICATION LOGIC ]] --
print("PHARMACII: Verifying ID against Whitelist...")

local function Authenticate()
    local success, response = pcall(function()
        -- Adding timestamp to bypass caching
        return game:HttpGet(WHITELIST_URL .. "?t=" .. os.time())
    end)

    if success then
        -- Decode the JSON list
        local decodeSuccess, whitelist = pcall(function() return HttpService:JSONDecode(response) end)
        
        if not decodeSuccess then
            warn("PHARMACII: Failed to read whitelist format.")
            return
        end

        local isWhitelisted = false

        -- Check ID
        for _, id in pairs(whitelist) do
            if tostring(id) == tostring(hwid) then
                isWhitelisted = true
                break
            end
        end

        if isWhitelisted then
            print("PHARMACII: ACCESS GRANTED. Loading Hub...")
            
            -- Load the Script
            local hubSuccess, hubCode = pcall(function()
                return game:HttpGet(HUB_URL)
            end)
            
            if hubSuccess then
                loadstring(hubCode)()
            else
                warn("PHARMACII: Whitelisted, but failed to fetch Hub script.")
            end
        else
            warn("PHARMACII: ACCESS DENIED.")
            print("Your ID ("..tostring(hwid)..") is not in the whitelist.")
            
            -- Notify user they are denied
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "ACCESS DENIED",
                Text = "ID copied. Send to Amiri.",
                Duration = 5
            })
        end
    else
        warn("PHARMACII: Connection Error (Check Whitelist URL).")
    end
end

task.spawn(Authenticate)
